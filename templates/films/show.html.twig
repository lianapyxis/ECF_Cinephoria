{% extends 'base.html.twig' %}

{% form_theme form with[
    'form/template.html.twig'
]%}

{% block body %}
    <film class="card">
        <div class="card-header">
            <h2 class="film-title-front">{{ film.title }} ({{ film.year }})</h2>
            <div class="rating-note-container">
                <div class="film-rating-front">{{ film.rating.getTitle }}</div>
                <div class="film-note">
                    {% if averageNote is same as 0.0 %}
                        {{ ux_icon('tabler:star', {class: 'star-off'}) }}
                        {{ ux_icon('tabler:star', {class: 'star-off'}) }}
                        {{ ux_icon('tabler:star', {class: 'star-off'}) }}
                        {{ ux_icon('tabler:star', {class: 'star-off'}) }}
                        {{ ux_icon('tabler:star', {class: 'star-off'}) }}
                    {% else %}
                        <input type="hidden" value="{{ averageNote }}" id="averageNote">
                    {% endif %}
                </div>
            </div>
            <div class="film-info-front-container">
                <div class="film-img">
                    <img src="{{ asset('uploads/' ~ film.getImgPath()) }}" class="img-film-front" width="250px" height="250px"/>
                </div>
                <div class="film-info-front">
                    <div><span>GENRE :</span>
                        {% if film.genres|length > 1 %}
                            {% for genre in film.genres|slice(0, (film.genres|length - 1)) %}
                                {{ genre.name }},
                            {% endfor %}
                            {% for genre in film.genres|slice((film.genres|length - 1), (film.genres|length)) %}
                                {{ genre.name }}
                            {% endfor %}
                        {% else %}
                            {% for genre in film.genres %}
                                {{ genre.name }}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div>
                        <span>FORMATS :</span>
                        {% if formats|length > 1 %}
                            {% for format in formats|slice(0, (formats|length - 1)) %}
                                {{ format }},
                            {% endfor %}
                            {% for format in formats|slice((formats|length - 1), (formats|length)) %}
                                {{ format }}
                            {% endfor %}
                        {% else %}
                            {% for format in formats %}
                                {{ format }}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="film-description-front">
                        <span>DESCRIPTION :</span>
                        <div>{{ film.description }}</div>
                    </div>
                </div>
            </div>

            <h4 class="mb-4">SÉANCES :</h4>
            <table class="table" id="frontSeances">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Heure</th>
                    <th>Format</th>
                    <th>Places restants</th>
                    <th>Prix</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                {% for seance in seances %}
                    <tr>
                        <td>{{ seance.getTimeStart|date('d.m.Y') }}</td>
                        <td>{{ seance.getTimeStart|date('H:i') }}-{{ seance.getTimeEnd|date('H:i') }}</td>
                        <td>{{ seance.getIdRoom.getFormat.title }}</td>
                        <td>{{ seance.restingPlaces }}</td>
                        <td>{{ seance.getPriceTtc }}€</td>
                        <td>
                            <a href="{{ path('seances_show', {'id': seance.id}) }}" class="btn btn-primary show-seance-details">SÉLÉCTIONNER LES SIÈGES</a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="12">Aucune séance trouvée</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

        </div>
    </film>

    <h5 class="comment-title-front">COMMENTAIRES :</h5>



    <div class="mt-3 mb-5">

        {% for comment in film.comments %}

            {% if comment.getStatus == 'PUBLISHED' %}
                <div class="card mt-3">
                    <div class="card-header comment-front">
                        <div>
                            {{ comment.user.username }}
                        </div>
                        <div>
                            {{ comment.getdateAdd|date('d/m/Y H/i') }}
                        </div>
                    </div>
                    <div class="card-body comment-front-content">
                        <p>{{ comment.comment }}</p>
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div class="card">
                <div>
                    <p>Aucun commentaire</p>
                </div>
            </div>
        {% endfor %}

    </div>
    {% if app.user%}
        <a href="{{ path('comments_create', {'film': film.id}) }}" data-turbo-frame="comment" class="btn-add-comment mt-3">
            Ajouter un commentaire...
        </a>
    {% endif %}
    <turbo-frame id="seance"></turbo-frame>
{#    <div class="modal-seance-details">
        <div>
            <div class="button-seance-close">X</div>
        </div>
        <div class="modal-seance-info">
            <div class="modal-seance-info-column">
                <div>DATE : <span class="seance-info-date"></span></div>
                <div>FILM : <span class="seance-info-hour"></span></div>
                <div>STATUT : <span class="seance-info-format"></span></div>
            </div>
        </div>
        <div class="modal-seance-places">
            <div>SÉLÉCTIONNEZ DES SIÈGES :</div>
            <div class="modal-place-types">
                <div class="place-type-reserved"><span></span>SIÈGE RÉSERVÉ</div>
                <div class="place-type-available"><span></span>SIÈGE DISPONIBLE</div>
                <div class="place-type-handicapped"><span></span>SIÈGE MOBILITÉ RÉDUITE DISPONIBLE</div>
                <div class="place-type-handicapped-reserved"><span></span>SIÈGE MOBILITÉ RÉDUITE RÉSERVÉ</div>
            </div>
            <div class="screen-modal"><span></span></div>
            <div class="modal-places">
                {% for row in seances[0].allPlaces %}
                    <div class="room-row">
                        {% for place in row %}
                            {% if place.reserved == 1 %}
                                <div class="checkbox-wrapper">
                                    <label>
                                    <input type="checkbox" id="{{ place.name }}" name="{{ place.name }}" value="{{ place.name }}" data-reserved="{{ place.reserved }}" data-special="{{ place.special }}" disabled>
                                    <span class="custom-checkbox"></span>
                                    </label>
                                </div>
                            {% else %}
                                <div class="checkbox-wrapper">
                                    <label>
                                    <input type="checkbox" id="{{ place.name }}" name="{{ place.name }}" value="{{ place.name }}" data-reserved="{{ place.reserved }}" data-special="{{ place.special }}">
                                    <span class="custom-checkbox"></span>
                                    </label>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="modal-seance-actions">
            <a href="#" class="btn btn-primary seance-action-select">PROCÉDER À LA RÉSERVATION</a>
        </div>
    </div>#}
{% endblock %}